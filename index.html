<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    
    <!-- üì± PWA Meta Tags -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <meta name="screen-orientation" content="landscape-primary" />
    <meta name="description" content="Sistema completo de gest√£o empresarial IARA HUB com chat interno, vendas, estoque e relat√≥rios" />
    <meta name="keywords" content="gest√£o, vendas, estoque, chat, relat√≥rios, empresa, sistema, IARA HUB" />
    <meta name="author" content="IARA HUB" />
    
    <!-- üé® Theme Colors -->
    <meta name="theme-color" content="#FF2C68" />
    <meta name="msapplication-navbutton-color" content="#FF2C68" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="msapplication-TileColor" content="#0D0C0C" />
    
    <!-- üì± PWA App Configuration -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-title" content="IARA HUB" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-orientation" content="landscape" />
    <meta name="application-name" content="IARA HUB" />
    
    <!-- üì± iOS Specific Icons -->
    <link rel="apple-touch-icon" href="/icons/icon-152x152.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/icons/icon-128x128.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-192x192.png" />
    
    <!-- üìÑ Manifest -->
    <link rel="manifest" href="/manifest.json" />
    
    <!-- üñºÔ∏è Icons -->
    <link rel="icon" type="image/svg+xml" href="/faticon.svg" />
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-192x192.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-192x192.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/icon-192x192.png" />
    <link rel="mask-icon" href="/icons/icon-192x192.png" color="#FF2C68" />
    
    <!-- üîÑ Preload Critical Resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://firestore.googleapis.com" />
    <link rel="dns-prefetch" href="https://firebase.googleapis.com" />
    
    <!-- üìä Open Graph -->
    <meta property="og:title" content="Sistema de Gest√£o IARA HUB" />
    <meta property="og:description" content="Sistema completo de gest√£o empresarial IARA HUB" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="/icons/icon-512x512.png" />
    
    <!-- üê¶ Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Sistema de Gest√£o IARA HUB" />
    <meta name="twitter:description" content="Sistema completo de gest√£o empresarial IARA HUB" />
    <meta name="twitter:image" content="/icons/icon-512x512.png" />
    
    <title>üì± IARA HUB - GESTAO INTELIGENTE</title>
  </head>
  <body>
    <div id="root"></div>
    
    <!-- üöÄ Service Worker Registration -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js')
            .then((registration) => {
              console.log('‚úÖ SW registrado:', registration.scope);
              
              // Notificar sobre atualiza√ß√µes
              registration.addEventListener('updatefound', () => {
                const newWorker = registration.installing;
                newWorker.addEventListener('statechange', () => {
                  if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    console.log('üîÑ Nova vers√£o dispon√≠vel');
                    // Aqui voc√™ pode mostrar um toast para o usu√°rio atualizar
                  }
                });
              });
            })
            .catch((error) => {
              console.error('‚ùå Erro no SW:', error);
            });
        });

        // üì± Detectar instala√ß√£o PWA
        let deferredPrompt;
        let installButton = null;

        // Fun√ß√£o para criar bot√£o de instala√ß√£o
        function createInstallButton(isIOS = false) {
          if (installButton) return; // Evitar duplicar
          
          installButton = document.createElement('div');
          installButton.innerHTML = `
            <div id="install-btn" style="
              position: fixed;
              bottom: 20px;
              right: 20px;
              z-index: 10000;
              background: linear-gradient(135deg, #FF2C68, #FF6B9D);
              color: white;
              border: none;
              padding: 18px 28px;
              border-radius: 35px;
              font-weight: bold;
              box-shadow: 0 8px 25px rgba(255, 44, 104, 0.5);
              cursor: pointer;
              transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
              font-family: 'Inter', Arial, sans-serif;
              font-size: 14px;
              text-align: center;
              max-width: 220px;
              animation: fadeInUp 0.5s ease-out, pulse 3s infinite 1s;
              border: 2px solid rgba(255, 255, 255, 0.2);
            " onclick="handleInstallClick()" onmouseover="this.style.transform='scale(1.05) translateY(-2px)'" onmouseout="this.style.transform='scale(1) translateY(0)'">"
              üì± ${isIOS ? 'Adicionar √† Tela Inicial' : 'Instalar App'}
              <div style="font-size: 12px; margin-top: 5px; opacity: 0.9;">
                ${isIOS ? 'Toque em ‚¨ÜÔ∏è ‚Üí Adicionar' : 'Clique para instalar'}
              </div>
            </div>
          `;
          
          document.body.appendChild(installButton);
        }

        // Fun√ß√£o global para lidar com instala√ß√£o
        window.handleInstallClick = () => {
          if (deferredPrompt) {
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then((choiceResult) => {
              if (choiceResult.outcome === 'accepted') {
                console.log('‚úÖ PWA instalado');
              }
              deferredPrompt = null;
            });
          } else {
            // Detectar iOS
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            
            // Para iOS, mostrar instru√ß√µes mais detalhadas
            const instructions = isIOS ? 
              'Para instalar no iPhone/iPad:\n\n1. Toque no bot√£o de compartilhar ‚¨ÜÔ∏è (na barra inferior)\n2. Role para baixo e selecione "Adicionar √† Tela de In√≠cio"\n3. Toque em "Adicionar" no canto superior direito\n\nO app aparecer√° na sua tela inicial!' :
              'Para instalar:\n\n1. Abra o menu do navegador (‚ãÆ)\n2. Selecione "Adicionar √† tela inicial" ou "Instalar app"\n3. Confirme a instala√ß√£o\n\nO app ser√° instalado no seu dispositivo!';
            
            alert(instructions);
          }
        };

        window.addEventListener('beforeinstallprompt', (e) => {
          e.preventDefault();
          deferredPrompt = e;
          console.log('üì± PWA pode ser instalado');
          createInstallButton(false);
        });

        // Para iOS e dispositivos que n√£o disparam beforeinstallprompt
        window.addEventListener('load', () => {
          setTimeout(() => {
            // Detectar iOS
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            // Detectar se √© standalone (j√° instalado)
            const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
            
            // S√≥ n√£o mostrar se j√° estiver em modo standalone (j√° instalado)
            if (!isStandalone && !deferredPrompt) {
              if (isIOS) {
                createInstallButton(true);
              } else {
                // Para Android sem beforeinstallprompt
                createInstallButton(false);
              }
            }
          }, 2000); // Aguardar 2 segundos para aparecer mais r√°pido
        });

        // üì± Detectar quando foi instalado
        window.addEventListener('appinstalled', () => {
          console.log('üéâ PWA foi instalado com sucesso!');
          deferredPrompt = null;
          
          // Tentar for√ßar orienta√ß√£o paisagem
          if (screen.orientation && screen.orientation.lock) {
            screen.orientation.lock('landscape-primary').catch((err) => {
              console.log('‚ö†Ô∏è N√£o foi poss√≠vel bloquear orienta√ß√£o:', err);
            });
          }
        });

        // üîÑ For√ßar orienta√ß√£o paisagem quando app carrega
        window.addEventListener('load', () => {
          // Verificar se √© uma PWA instalada
          if (window.matchMedia('(display-mode: standalone)').matches) {
            console.log('üì± App rodando como PWA');
            
            // Tentar bloquear orienta√ß√£o em paisagem
            if (screen.orientation && screen.orientation.lock) {
              screen.orientation.lock('landscape-primary').catch((err) => {
                console.log('‚ö†Ô∏è Orienta√ß√£o n√£o pode ser bloqueada:', err);
              });
            }
          }
        });
      }

      // üîî Solicitar permiss√£o para notifica√ß√µes
      if ('Notification' in window && navigator.serviceWorker) {
        if (Notification.permission === 'default') {
          Notification.requestPermission().then((permission) => {
            console.log('üîî Permiss√£o de notifica√ß√£o:', permission);
          });
        }
      }
    </script>
    
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
